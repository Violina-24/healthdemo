<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Admin Dashboard - MBBS Counselling</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        :root {
            --sidebar-width: 250px;
            --header-height: 60px;
            --primary-color: #004f98;
            --secondary-color: #e0e7ff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background-color: var(--primary-color);
            color: white;
            padding-top: var(--header-height);
            transition: all 0.3s;
            z-index: 1000;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
        }

        .sidebar-menu li {
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .sidebar-menu li a {
            color: white;
            text-decoration: none;
            display: block;
        }

        .sidebar-menu li:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu li.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-left: 4px solid white;
        }

        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content Styles */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 20px;
            min-height: calc(100vh - var(--header-height));
        }

        /* Header Styles */
        .admin-header {
            height: var(--header-height);
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            z-index: 999;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .user-profile {
            display: flex;
            align-items: center;
        }

        .user-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        /* Dashboard Cards */
        .stats-card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }

        .stats-card .card-body {
            padding: 1.5rem;
        }

        .stats-card .card-title {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .stats-card .card-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0;
        }

        /* Application Table */
        .application-table {
            width: 100%;
            border-collapse: collapse;
        }

        .application-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 15px;
            text-align: left;
        }

        .application-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
            vertical-align: middle;
        }

        .application-table tr:hover {
            background-color: #f5f5f5;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-accepted {
            background-color: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Form Styles */
        .form-container {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .form-header {
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                left: -var(--sidebar-width);
            }

            .sidebar.active {
                left: 0;
            }

            .main-content {
                margin-left: 0;
            }

            .toggle-sidebar {
                display: block !important;
            }
        }

        .toggle-sidebar {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Preview Modal */
        .preview-modal iframe {
            width: 100%;
            height: 500px;
            border: none;
        }
        /* Sidebar Footer Styles */
.sidebar-footer {
    background-color: rgba(0, 0, 0, 0.1);
}

.sidebar-footer a:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

/* Ensure main content has enough padding at bottom */
.main-content {
    padding-bottom: 80px; /* Add space for footer */
}

.course-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .course-table th {
            background-color: var(--primary-color);
            color: white;
        }

        .course-table tr:hover {
            background-color: #f5f5f5;
        }
    </style>
</head>
<body>
<!-- Admin Header -->
<header class="admin-header">
    <button class="toggle-sidebar" id="toggleSidebar">
        <i class="bi bi-list"></i>
    </button>
    <div class="user-profile">
        <img src="/images/admin-avatar.png" alt="Admin Avatar" id="adminAvatar">
        <span id="adminName">Loading...</span>
        <a href="/api/logout" class="btn btn-sm btn-outline-danger ms-3">
            <i class="bi bi-box-arrow-right"></i> Logout
        </a>
    </div>
</header>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <ul class="sidebar-menu">
        <li class="active" data-section="dashboard">
            <a href="#dashboard">
                <i class="bi bi-speedometer2"></i> Dashboard
            </a>
        </li>
        <li data-section="applications">
            <a href="#applications">
                <i class="bi bi-file-earmark-text"></i> Applications
            </a>
        </li>
        <li data-section="reports">
            <a href="#reports">
                <i class="bi bi-graph-up"></i> Reports
            </a>
        </li>
        <li data-section="uploadAdvt">
            <a href="#uploadAdvt">
                <i class="bi bi-megaphone"></i> Upload Advertisements
            </a>
        </li>
        <li data-section="uploadAdmissions">
            <a href="#uploadAdmissions">
                <i class="bi bi-mortarboard"></i> Upload Ongoing Admissions
            </a>
        </li>
    </ul>

    <div class="sidebar-footer" style="position: absolute; bottom: 0; width: 100%; padding: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
        <a href="/login" class="d-flex align-items-center text-white text-decoration-none" style="padding: 10px 20px; border-radius: 5px; transition: background-color 0.3s;">
            <i class="bi bi-box-arrow-right me-3"></i>
            <span>Logout</span>
        </a>
    </div>
</div>

<!-- Main Content -->
<!-- Main Content -->
<div class="main-content">
    <!-- Dashboard Section -->
    <div class="content-section active" id="dashboard-section">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3>Welcome, <span id="welcomeName">Admin</span></h3>
                <small class="text-muted" id="currentDate"></small>
            </div>

            <!-- Stats Cards -->
            <div class="row">
                <div class="col-md-3">
                    <div class="card stats-card text-white bg-primary" id="totalApplicationsCard">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="card-title">Total Applications</h5>
                                    <h2 class="card-value" id="totalApplications">0</h2>
                                </div>
                                <i class="bi bi-file-earmark-text fs-1"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stats-card text-white bg-success" id="acceptedApplicationsCard">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="card-title">Accepted</h5>
                                    <h2 class="card-value" id="acceptedApplications">0</h2>
                                </div>
                                <i class="bi bi-check-circle fs-1"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stats-card text-white bg-danger" id="rejectedApplicationsCard">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="card-title">Rejected</h5>
                                    <h2 class="card-value" id="rejectedApplications">0</h2>
                                </div>
                                <i class="bi bi-x-circle fs-1"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card stats-card text-white bg-warning" id="totalCoursesCard">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="card-title">Total Courses</h5>
                                    <h2 class="card-value" id="totalCourses">0</h2>
                                </div>
                                <i class="bi bi-book fs-1"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5><i class="bi bi-clock-history me-2"></i>Recent Activity</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush" id="activityList">
                        <!-- Activities will be loaded here -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Applications Section -->
    <div class="content-section" id="applications-section">
        <div class="container-fluid">
            <h3 class="mb-4"><i class="bi bi-file-earmark-text me-2"></i>Applications</h3>

            <!-- Application Stats Cards (Same as dashboard but smaller) -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card stats-card text-white bg-primary" id="filterTotalApplications">
                        <div class="card-body py-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-0">Total</h6>
                                    <h4 class="card-value mb-0" id="filterTotalCount">0</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card stats-card text-white bg-success" id="filterAcceptedApplications">
                        <div class="card-body py-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-0">Accepted</h6>
                                    <h4 class="card-value mb-0" id="filterAcceptedCount">0</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card stats-card text-white bg-danger" id="filterRejectedApplications">
                        <div class="card-body py-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title mb-0">Rejected</h6>
                                    <h4 class="card-value mb-0" id="filterRejectedCount">0</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Applications Table -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">All Applications</h5>
                    <div class="input-group" style="width: 300px;">
                        <input type="text" class="form-control" placeholder="Search applications..." id="applicationSearch">
                        <button class="btn btn-outline-secondary" type="button">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="application-table table">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Applicant Name</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Applied Date</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody id="applicationsTableBody">
                            <!-- Applications will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <nav class="mt-3">
                        <ul class="pagination justify-content-center" id="applicationsPagination">
                            <!-- Pagination will be loaded here -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <!-- Reports Section -->
    <div class="content-section" id="reports-section">
        <div class="container-fluid">
            <h3 class="mb-4"><i class="bi bi-graph-up me-2"></i>Reports</h3>
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="bi bi-graph-up fs-1 text-muted mb-3"></i>
                    <h4>Reports Section</h4>
                    <p class="text-muted">Reports functionality will be implemented here</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Advertisement Section -->
    <div class="content-section" id="uploadAdvt-section">
        <div class="container-fluid">
            <h3 class="mb-4"><i class="bi bi-megaphone me-2"></i>Upload Advertisement</h3>
            <div class="form-container">
                <div class="form-header">
                    <h5>New Advertisement</h5>
                    <p class="text-muted mb-0">Fill the form to upload a new advertisement</p>
                </div>
                <form id="advtForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="advtNo" class="form-label">Advertisement Number</label>
                            <input type="text" class="form-control" id="advtNo" required>
                        </div>
                        <div class="col-md-6">
                            <label for="advtDate" class="form-label">Advertisement Date</label>
                            <input type="date" class="form-control" id="advtDate" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="advtDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="advtDescription" rows="3" required></textarea>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="advtOpenDate" class="form-label">Open Date</label>
                            <input type="date" class="form-control" id="advtOpenDate" required>
                        </div>
                        <div class="col-md-6">
                            <label for="advtEndDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="advtEndDate" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="advtFile" class="form-label">Advertisement File (PDF)</label>
                        <input type="file" class="form-control" id="advtFile" accept=".pdf" required>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button type="reset" class="btn btn-outline-secondary me-2">Reset</button>
                        <button type="submit" class="btn btn-primary">Upload Advertisement</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Upload Ongoing Admissions Section -->
    <div class="content-section" id="uploadAdmissions-section">
        <div class="container-fluid">
            <h3 class="mb-4"><i class="bi bi-mortarboard me-2"></i>Upload Ongoing Admissions</h3>
            <div class="form-container">
                <div class="form-header">
                    <h5>New Admission Notice</h5>
                    <p class="text-muted mb-0">Fill the form to upload a new admission notice</p>
                </div>
                <form id="admissionForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="admissionNo" class="form-label">Admission Notice Number</label>
                            <input type="text" class="form-control" id="admissionNo" required>
                        </div>
                        <div class="col-md-6">
                            <label for="admissionDate" class="form-label">Notice Date</label>
                            <input type="date" class="form-control" id="admissionDate" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="admissionDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="admissionDescription" rows="3" required></textarea>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="admissionOpenDate" class="form-label">Open Date</label>
                            <input type="date" class="form-control" id="admissionOpenDate" required>
                        </div>
                        <div class="col-md-6">
                            <label for="admissionEndDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="admissionEndDate" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="admissionFile" class="form-label">Admission Notice File (PDF)</label>
                        <input type="file" class="form-control" id="admissionFile" accept=".pdf" required>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button type="reset" class="btn btn-outline-secondary me-2">Reset</button>
                        <button type="submit" class="btn btn-primary">Upload Admission Notice</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="content-section" id="courses-section">
    <div class="container-fluid">
        <h3 class="mb-4"><i class="bi bi-book me-2"></i>Manage Courses</h3>

        <div class="card mb-4">
            <div class="card-header">
                <h5>Add New Course</h5>
            </div>
            <div class="card-body">
                <form id="courseForm" class="course-form">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="courseName" class="form-label">Course Name</label>
                            <input type="text" class="form-control" id="courseName" required>
                        </div>
                        <div class="col-md-6">
                            <label for="instituteName" class="form-label">Institute</label>
                            <input type="text" class="form-control" id="instituteName" required>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button type="submit" class="btn btn-primary">Add Course</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h5>All Courses</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table course-table">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Course Name</th>
                            <th>Institute</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody id="coursesTableBody">
                        <!-- Courses will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- Application Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Application Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body preview-modal">
                <iframe id="applicationPreviewFrame" src="about:blank"></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" id="acceptFromPreview">Accept</button>
                <button type="button" class="btn btn-danger" id="rejectFromPreview">Reject</button>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="footer bg-dark text-white py-3">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6">
                <p class="mb-0">Â© 2025 Meghalaya State Counselling Authority. All rights reserved.</p>
            </div>
            <div class="col-md-6 text-md-end">
                <p class="mb-0">Admin Dashboard v1.1.0</p>
            </div>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Global variables
    let currentAdmin = {};
    let applications = [];
    let currentApplicationPage = 1;
    const applicationsPerPage = 10;

    // DOM Content Loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Check admin role
        const userRole = sessionStorage.getItem('userRole');
        if (userRole !== 'admin') {
            window.location.href = '/login';
            return;
        }

        // Initialize admin data
        loadAdminData();

        // Initialize date
        updateCurrentDate();

        // Initialize sidebar navigation
        setupSidebar();

        // Initialize forms
        setupForms();

       // Load initial data
        loadApplications();
        loadCourses();
        loadActivities();
        setupModalEvents();
    });

    // Load admin data
    function loadAdminData() {
        // In a real app, you would fetch this from your API
        const adminEmail = sessionStorage.getItem('userEmail');
        const adminId = sessionStorage.getItem('userId');

        // For demo purposes, we'll use mock data
        currentAdmin = {
            id: adminId,
            name: "Admin User",
            email: adminEmail,
            role: "admin"
        };

        // Update UI
        document.getElementById('adminName').textContent = currentAdmin.name;
        document.getElementById('welcomeName').textContent = currentAdmin.name;
    }

    // Update current date
    function updateCurrentDate() {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const today = new Date();
        document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', options);
    }

    // Setup sidebar navigation
    function setupSidebar() {
        // Toggle sidebar on mobile
        document.getElementById('toggleSidebar').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });

        // Handle sidebar menu clicks
        const menuItems = document.querySelectorAll('.sidebar-menu li');
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                // Update active state
                menuItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');

                // Show corresponding section
                const sectionId = this.getAttribute('data-section');
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(`${sectionId}-section`).classList.add('active');
            });
        });
    }
    // Add confirmation to sidebar logout
document.querySelector('.sidebar-footer a').addEventListener('click', function(e) {
    if (!confirm('Are you sure you want to logout?')) {
        e.preventDefault();
    }
});

    // Setup forms
    function setupForms() {
        // Advertisement form
        document.getElementById('advtForm').addEventListener('submit', function(e) {
            e.preventDefault();
            uploadAdvertisement();
        });

        // Admission form
        document.getElementById('admissionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            uploadAdmission();
        });

        // Course form
        document.getElementById('courseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addCourse();
        });
    }

    // Load applications from API
    function loadApplications(page = 1) {
        currentApplicationPage = page;

        // Fetch applications from your API
        fetch('/application/applications')
            .then(response => response.json())
            .then(data => {
                applications = data;
                updateApplicationStats();
                renderApplicationsTable();
                renderApplicationsPagination();
            })
            .catch(error => {
                console.error('Error loading applications:', error);
                // Fallback to mock data if API fails
                applications = generateMockApplications(45);
                updateApplicationStats();
                renderApplicationsTable();
                renderApplicationsPagination();
            });
    }

    // Load courses from API
    function loadCourses() {
        fetch('/courses', {  // Changed from '/api/courses' to '/courses'
        credentials: 'include'  // Important for session cookies
    })
            .then(response => response.json())
            .then(data => {
                courses = data;
                updateCourseStats();
                renderCoursesTable();
            })
            .catch(error => {
                console.error('Error loading courses:', error);
                // Fallback to mock data if API fails
                courses = generateMockCourses();
                updateCourseStats();
                renderCoursesTable();
            });
    }

    // Generate mock courses (fallback)
    function generateMockCourses() {
        return [
            { id: 1, name: "MBBS", institute: "AIIMS Delhi" },
            { id: 2, name: "BDS", institute: "Maulana Azad Dental College" },
            { id: 3, name: "B.Sc Nursing", institute: "CMC Vellore" }
        ];
    }

    // Update application stats
    function updateApplicationStats() {
        const total = applications.length;
        const accepted = applications.filter(app => app.status === 'accepted').length;
        const rejected = applications.filter(app => app.status === 'rejected').length;

        document.getElementById('totalApplications').textContent = total;
        document.getElementById('acceptedApplications').textContent = accepted;
        document.getElementById('rejectedApplications').textContent = rejected;
    }

    // Update course stats
    function updateCourseStats() {
        document.getElementById('totalCourses').textContent = courses.length;
    }

    // Update renderCoursesTable to match your entity structure
function renderCoursesTable() {
    const tableBody = document.getElementById('coursesTableBody');
    tableBody.innerHTML = '';

    courses.forEach(course => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${course.id}</td>
            <td>${course.coursename}</td>  <!-- Changed from course.name -->
            <td>${course.institute}</td>
            <td>
                <button class="btn btn-sm btn-outline-primary me-1 edit-course" data-id="${course.id}">
                    <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger delete-course" data-id="${course.id}">
                    <i class="bi bi-trash"></i>
                </button>
            </td>
        `;
        tableBody.appendChild(row);
    });

        // Add event listeners for course actions
        document.querySelectorAll('.edit-course').forEach(btn => {
            btn.addEventListener('click', function() {
                const courseId = parseInt(this.getAttribute('data-id'));
                editCourse(courseId);
            });
        });

        document.querySelectorAll('.delete-course').forEach(btn => {
            btn.addEventListener('click', function() {
                const courseId = parseInt(this.getAttribute('data-id'));
                deleteCourse(courseId);
            });
        });
    }

    // Add new course
    function addCourse() {
        const courseName = document.getElementById('courseName').value;
        const instituteName = document.getElementById('instituteName').value;

        // In a real app, you would send this to your API
        fetch('/api/courses', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: courseName,
                institute: instituteName
            })
        })
        .then(response => response.json())
        .then(newCourse => {
            courses.push(newCourse);
            updateCourseStats();
            renderCoursesTable();
            document.getElementById('courseForm').reset();
            addActivity(`Added new course: ${courseName}`);
        })
        .catch(error => {
            console.error('Error adding course:', error);
            // Fallback to client-side addition if API fails
            const newCourse = {
                id: courses.length + 1,
                name: courseName,
                institute: instituteName
            };
            courses.push(newCourse);
            updateCourseStats();
            renderCoursesTable();
            document.getElementById('courseForm').reset();
            addActivity(`Added new course: ${courseName}`);
        });
    }

    // Edit course
    function editCourse(courseId) {
        const course = courses.find(c => c.id === courseId);
        if (course) {
            document.getElementById('courseName').value = course.name;
            document.getElementById('instituteName').value = course.institute;

            // Change form to update mode
            const form = document.getElementById('courseForm');
            form.querySelector('button[type="submit"]').textContent = 'Update Course';
            form.onsubmit = function(e) {
                e.preventDefault();
                updateCourse(courseId);
            };
        }
    }

    // Update course
    function updateCourse(courseId) {
        const courseName = document.getElementById('courseName').value;
        const instituteName = document.getElementById('instituteName').value;

        // In a real app, you would send this to your API
        fetch(`/api/courses/${courseId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: courseName,
                institute: instituteName
            })
        })
        .then(response => {
            if (response.ok) {
                const index = courses.findIndex(c => c.id === courseId);
                if (index !== -1) {
                    courses[index] = { id: courseId, name: courseName, institute: instituteName };
                    renderCoursesTable();
                    resetCourseForm();
                    addActivity(`Updated course: ${courseName}`);
                }
            }
        })
        .catch(error => {
            console.error('Error updating course:', error);
            // Fallback to client-side update if API fails
            const index = courses.findIndex(c => c.id === courseId);
            if (index !== -1) {
                courses[index] = { id: courseId, name: courseName, institute: instituteName };
                renderCoursesTable();
                resetCourseForm();
                addActivity(`Updated course: ${courseName}`);
            }
        });
    }

    // Delete course
    function deleteCourse(courseId) {
        if (confirm('Are you sure you want to delete this course?')) {
            // In a real app, you would call your API
            fetch(`/api/courses/${courseId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    courses = courses.filter(c => c.id !== courseId);
                    updateCourseStats();
                    renderCoursesTable();
                    addActivity(`Deleted course ID: ${courseId}`);
                }
            })
            .catch(error => {
                console.error('Error deleting course:', error);
                // Fallback to client-side deletion if API fails
                courses = courses.filter(c => c.id !== courseId);
                updateCourseStats();
                renderCoursesTable();
                addActivity(`Deleted course ID: ${courseId}`);
            });
        }
    }

    // Reset course form
    function resetCourseForm() {
        document.getElementById('courseForm').reset();
        const form = document.getElementById('courseForm');
        form.querySelector('button[type="submit"]').textContent = 'Add Course';
        form.onsubmit = function(e) {
            e.preventDefault();
            addCourse();
        };
    }


    function renderApplicationsTable() {
    const tableBody = document.getElementById('applicationsTableBody');
    tableBody.innerHTML = '';

    // Calculate pagination
    const startIndex = (currentApplicationPage - 1) * applicationsPerPage;
    const endIndex = Math.min(startIndex + applicationsPerPage, applications.length);
    const pageApplications = applications.slice(startIndex, endIndex);

    // Render each application
    pageApplications.forEach(app => {
        const row = document.createElement('tr');
        // Handle null status
        const status = app.status || 'pending'; // default to 'pending' if null
        const statusDisplay = status.charAt(0).toUpperCase() + status.slice(1);

        row.innerHTML = `
            <td>${app.id}</td>
            <td>${app.applicantName}</td>
            <td>${app.email}</td>
            <td><span class="status-badge status-${status}">${statusDisplay}</span></td>
            <td>${app.appliedDate ? new Date(app.appliedDate).toLocaleDateString() : ''}</td>
            <td>
                <button class="btn btn-sm btn-success me-1 accept-btn" data-id="${app.id}">
                    <i class="bi bi-check-lg"></i>
                </button>
                <button class="btn btn-sm btn-danger me-1 reject-btn" data-id="${app.id}">
                    <i class="bi bi-x-lg"></i>
                </button>
                <button class="btn btn-sm btn-primary preview-btn" data-id="${app.id}">
                    <i class="bi bi-eye"></i>
                </button>
            </td>
        `;
        tableBody.appendChild(row);
    });


        // Add event listeners to action buttons
        document.querySelectorAll('.accept-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const appId = parseInt(this.getAttribute('data-id'));
                updateApplicationStatus(appId, 'accepted');
            });
        });

        document.querySelectorAll('.reject-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const appId = parseInt(this.getAttribute('data-id'));
                updateApplicationStatus(appId, 'rejected');
            });
        });

        document.querySelectorAll('.preview-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const appId = parseInt(this.getAttribute('data-id'));
                previewApplication(appId);
            });
        });

        // Add click events to stats cards for filtering
        document.getElementById('filterTotalApplications').addEventListener('click', () => filterApplications('all'));
        document.getElementById('filterAcceptedApplications').addEventListener('click', () => filterApplications('accepted'));
        document.getElementById('filterRejectedApplications').addEventListener('click', () => filterApplications('rejected'));
    }

    // Filter applications
    function filterApplications(status) {
        // In a real app, you would fetch filtered data from the server
        // For demo, we'll just highlight the filtered rows
        const rows = document.querySelectorAll('#applicationsTableBody tr');

        rows.forEach(row => {
            const statusBadge = row.querySelector('.status-badge');
            const appStatus = statusBadge.textContent.toLowerCase();

            if (status === 'all' || appStatus === status) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    // Render applications pagination
    function renderApplicationsPagination() {
        const totalPages = Math.ceil(applications.length / applicationsPerPage);
        const pagination = document.getElementById('applicationsPagination');
        pagination.innerHTML = '';

        // Previous button
        const prevLi = document.createElement('li');
        prevLi.className = `page-item ${currentApplicationPage === 1 ? 'disabled' : ''}`;
        prevLi.innerHTML = `<a class="page-link" href="#">Previous</a>`;
        prevLi.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentApplicationPage > 1) {
                loadApplications(currentApplicationPage - 1);
            }
        });
        pagination.appendChild(prevLi);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            const pageLi = document.createElement('li');
            pageLi.className = `page-item ${i === currentApplicationPage ? 'active' : ''}`;
            pageLi.innerHTML = `<a class="page-link" href="#">${i}</a>`;
            pageLi.addEventListener('click', (e) => {
                e.preventDefault();
                loadApplications(i);
            });
            pagination.appendChild(pageLi);
        }

        // Next button
        const nextLi = document.createElement('li');
        nextLi.className = `page-item ${currentApplicationPage === totalPages ? 'disabled' : ''}`;
        nextLi.innerHTML = `<a class="page-link" href="#">Next</a>`;
        nextLi.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentApplicationPage < totalPages) {
                loadApplications(currentApplicationPage + 1);
            }
        });
        pagination.appendChild(nextLi);
    }

    // Update application status
    function updateApplicationStatus(appId, newStatus) {
        // In a real app, you would make an API call to update the status
        const appIndex = applications.findIndex(app => app.id === appId);
        if (appIndex !== -1) {
            applications[appIndex].status = newStatus;

            // Update UI
            updateApplicationStats();
            renderApplicationsTable();

            // Add to activity log
            addActivity(`Application #${appId} status changed to ${newStatus}`);
        }
    }

    // Preview application
    function previewApplication(appId) {
        const app = applications.find(a => a.id === appId);
        if (app) {
            const previewFrame = document.getElementById('applicationPreviewFrame');
            previewFrame.src = app.documentUrl;

            const previewModal = new bootstrap.Modal(document.getElementById('previewModal'));
            previewModal.show();

            // Set the current application ID for the modal buttons
            document.getElementById('acceptFromPreview').setAttribute('data-id', appId);
            document.getElementById('rejectFromPreview').setAttribute('data-id', appId);
        }
    }

    // Setup modal events
    function setupModalEvents() {
        document.getElementById('acceptFromPreview').addEventListener('click', function() {
            const appId = parseInt(this.getAttribute('data-id'));
            updateApplicationStatus(appId, 'accepted');
            bootstrap.Modal.getInstance(document.getElementById('previewModal')).hide();
        });

        document.getElementById('rejectFromPreview').addEventListener('click', function() {
            const appId = parseInt(this.getAttribute('data-id'));
            updateApplicationStatus(appId, 'rejected');
            bootstrap.Modal.getInstance(document.getElementById('previewModal')).hide();
        });
    }

    // Upload advertisement
    function uploadAdvertisement() {
        // In a real app, you would upload the file to your server
        const advtNo = document.getElementById('advtNo').value;

        // Add to activity log
        addActivity(`New advertisement uploaded: ${advtNo}`);

        // Reset form
        document.getElementById('advtForm').reset();

        // Show success message
        alert('Advertisement uploaded successfully!');
    }

    // Upload admission
    function uploadAdmission() {
        // In a real app, you would upload the file to your server
        const admissionNo = document.getElementById('admissionNo').value;

        // Add to activity log
        addActivity(`New admission notice uploaded: ${admissionNo}`);

        // Reset form
        document.getElementById('admissionForm').reset();

        // Show success message
        alert('Admission notice uploaded successfully!');
    }

    // Load activities
    function loadActivities() {
        // In a real app, you would fetch this from your API
        const mockActivities = [
            { message: "System updated to version 2.0", time: "2 hours ago" },
            { message: "New advertisement uploaded: ADVT-2023-001", time: "5 hours ago" },
            { message: "Application #1234 was accepted", time: "1 day ago" },
            { message: "User admin@example.com logged in", time: "1 day ago" }
        ];

        const activityList = document.getElementById('activityList');
        mockActivities.forEach(activity => {
            const li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center';
            li.innerHTML = `
                <span>${activity.message}</span>
                <small class="text-muted">${activity.time}</small>
            `;
            activityList.appendChild(li);
        });
    }

    // Add activity to log
    function addActivity(message) {
        const now = new Date();
        const timeString = formatTimeDifference(now);

        const activityList = document.getElementById('activityList');
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `
            <span>${message}</span>
            <small class="text-muted">Just now</small>
        `;

        // Insert at the top
        if (activityList.firstChild) {
            activityList.insertBefore(li, activityList.firstChild);
        } else {
            activityList.appendChild(li);
        }

        // Update time display after a minute
        setTimeout(() => {
            li.querySelector('small').textContent = '1 minute ago';
        }, 60000);
    }

    // Format time difference
    function formatTimeDifference(date) {
        const now = new Date();
        const diff = now - date;

        const minutes = Math.floor(diff / 60000);
        if (minutes < 1) return "Just now";
        if (minutes < 60) return `${minutes} minute${minutes === 1 ? '' : 's'} ago`;

        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours} hour${hours === 1 ? '' : 's'} ago`;

        const days = Math.floor(hours / 24);
        return `${days} day${days === 1 ? '' : 's'} ago`;
    }
</script>
</body>
</html>