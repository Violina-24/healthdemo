<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <title>Login to MBBS Counselling</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/styles.css">
    <style>
        /* Responsive design adjustments */
        @media (max-width: 768px) {
            .login-card {
                margin: 20px;
            }
            .card-title {
                font-size: 1.5rem;
            }
        }

        .login-card {
            max-width: 400px;
            margin: 30px auto;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, #e0e7ff, #f3f4f6);
        }

        .login-card .form-icon {
            font-size: 1.2rem;
            margin-right: 10px;
            color: #004f98;
        }

        .login-card .form-control {
            padding-left: 2.5rem;
        }

        .login-card .submit {
            background-color: #004f98;
            color: #fff;
            transition: background-color 0.3s;
        }

        .login-card .submit:hover {
            background-color: #003366;
        }

        .login-card .link-login {
            color: #004f98;
        }

        .login-card .link-login:hover {
            text-decoration: underline;
        }

        .heading {
            font-weight: bold;
            color: #004f98;
        }

        .label-bottom-login {
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>

<body>
<!-- Header Section -->
<header class="shadow-sm" style="background-color: darkblue;">
    <div class="ind-container pt-3 mb-0 w-100">
        <div class="d-flex align-items-start gap-4">
            <img src="/images/emblem.png" alt="National Emblem" class="emblem" />
            <div class="w-100">
                <h1 class="fs-5 fw-semibold text-light mb-1">
                    MEGHALAYA STATE COUNSELLING AUTHORITY FOR MEDICAL EDUCATION
                </h1>
                <p class="mb-0 text-light fs-6 fw-medium">GOVERNMENT OF MEGHALAYA</p>
            </div>
        </div>
    </div>
</header>

<!-- Navbar -->
<div class="navbar d-flex justify-content-start ps-3 shadow" style="margin-top: 0; padding-top: 0; padding-bottom:0; background-color: #004f98;">
    <a href="index" class="text-light fs-6 mx-2 text-decoration-none">Home</a>
    <a href="login" class="text-light fs-6 mx-2 text-decoration-none">Login</a>
</div>

<!-- Login Card -->
<div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="card p-4 shadow-lg" style="max-width: 400px; width: 100%;">
        <i class="bi bi-person-circle fs-1 text-primary text-center"></i>
        <h5 class="text-center mb-4 fw-semibold">Login</h5>
        <form id="loginform">
            <div class="mb-3">
                <label class="form-label fw-semibold">
                    <i class="bi bi-envelope-fill me-2"></i>Email
                </label>
                <div class="input-group">
                    <span class="input-group-text bg-light">
                        <i class="bi bi-person-fill"></i>
                    </span>
                    <input type="text" name="email" class="form-control" placeholder="Enter your email" required >
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label fw-semibold">
                    <i class="bi bi-lock-fill me-2"></i>Password
                </label>
                <div class="input-group">
                    <span class="input-group-text bg-light">
                        <i class="bi bi-lock"></i>
                    </span>
                    <input type="password" name="password" class="form-control" placeholder="Enter your password" required >
                </div>
                <a href="forgotpassword.html"class="text-decoration-none fs-6"> Forgot Password?</a>
            </div>
            <!-- CAPTCHA Section with Canvas -->
            <div class="mb-3">
                <label class="form-label fw-semibold">
                    <i class="bi bi-lock-fill me-2"></i>Captcha
                </label>
                <div class="d-flex align-items-center mb-2 w-100">
                    <canvas id="captchaCanvas" height="30" class="form-control p-0 me-2" style="flex: 1;"></canvas>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="generateCaptcha()">⟳</button>
                </div>
                <input type="text" id="captchaInput" class="form-control" placeholder="Enter captcha" required>
            </div>


            <button type="submit" class="btn btn-primary w-100 mt-3">
                <i class="bi bi-box-arrow-in-right"></i> Sign In
            </button>
        </form>
        <p class="text-center mt-3">
            Don't have an account? <a href="/register" class="text-decoration-none">Register here</a>
        </p>
    </div>
</div>


<!-- Footer -->
<footer class="footer bg-dark text-white mt-auto py-4">
    <div class="text-center">
        <p class="mb-1">© 2025 Meghalaya State Counselling Authority. All rights reserved.</p>
        <p class="text-secondary mb-0">For technical support: support@meghalayamedical.gov.in</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // CAPTCHA with background lines
    function generateCaptcha() {
        const canvas = document.getElementById("captchaCanvas");
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#f0f0f0";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw random lines
        for (let i = 0; i < 5; i++) {
            ctx.strokeStyle = `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(
                Math.random() * 255
            )}, ${Math.floor(Math.random() * 255)}, 0.7)`;
            ctx.beginPath();
            ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
            ctx.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
            ctx.stroke();
        }

        // Generate and draw CAPTCHA
        const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        let captcha = "";
        for (let i = 0; i < 6; i++) {
            captcha += characters.charAt(Math.floor(Math.random() * characters.length));
        }
        ctx.font = "24px Arial";
        ctx.fillStyle = "#000";
        ctx.textBaseline = "middle";
        ctx.fillText(captcha, 50, canvas.height / 2);
        canvas.setAttribute("data-captcha", captcha);
    }

    document.getElementById("loginform").addEventListener("submit", function (event) {
        event.preventDefault();

        const userCaptcha = document.getElementById("captchaInput").value;
        const generatedCaptcha = document.getElementById("captchaCanvas").getAttribute("data-captcha");

        if (userCaptcha !== generatedCaptcha) {
            alert("Captcha does not match. Please try again.");
            generateCaptcha();
            return;
        }

        const formData = {
            email: document.querySelector("input[name='email']").value,
            password: document.querySelector("input[name='password']").value
        };

        fetch("http://localhost:8082/api/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData),
            credentials: "include"
        })
        .then(response => {
            if (!response.ok) throw new Error("Login failed");
            return response.json();
        })
        .then(data => {
            if (data.message === "Login Successful") {
                alert("Login Successful!");
                window.location.href = "/home";
            } else {
                alert("Invalid email or password!");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("An error occurred. Please try again.");
        });
    });

    window.onload = generateCaptcha;
</script>
</body>

</html>
